# dotnet-dpz3-vdisk

基于dpz3开发套件二次扩展的一套基于4K数据块可扩展虚拟盘文件存储组件(.Net Standard)

## 简单的块状虚拟盘存储

所有数据都以4K块（即每一个存储块都是4096字节）的形式存储到vdk格式文件中

## 简单类型控制，以低复杂度方式参与简单使用场景

虚拟盘vdk格式只，只存在三种形式的块：盘信息块、存储信息块和数据信息块。

### 盘信息块

盘信息块在文件的初始0位信息块，用来存储所有和虚拟盘相关的信息

| 寻址入口 | 数据类型 | 名称 | 说明 |
| :------------ | :------------ | :------------ | :------------ |
| 0x00 | long | Sign | 文件标志，固定为dvdk |
| 0x04 | int | Version | 协议版本 |
| 0x06 | long | DataBlocks | 虚拟盘中的数据块数量 |

### 存储信息块

存储信息块在文件的初始从1位信息块开始存储，用来存储所有虚拟盘内的文件夹和文件相关的信息

| 寻址入口 | 数据长度 | 名称 | 说明 |
| :------------ | :------------ | :------------ | :------------ |
| 0x00 | long | NextPosition | 下一个存储信息块的寻址 |
| 0x04 | long | FirstChildPosition | 关联存储块的首个块的寻址，如存储的对象为文件夹，则指向文件夹内第一个文件或文件夹的寻址；如存储的对象为文件，则指向文件的第一个数据信息块 |
| 0x08 | byte | Type | 存储类型，分为文件、文件夹 |
| 0x09 | byte[256] | Name | 存储名称，最长256字节 |

### 数据信息块

数据信息块是用来存储所有文件实际的数据

| 寻址入口 | 数据长度 | 名称 | 说明 |
| :------------ | :------------ | :------------ | :------------ |
| 0x00 | long | NextPosition | 下一个存储信息块的寻址 |
| 0x04 | int | Length | 数据长度 |
| 0x05 | byte[Length] | Data | 存储数据，由数据长度定义大小 |